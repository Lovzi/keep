---
title: Kafka事务原理
categories: Kafka
tags:
  - Kafka
date: 2021-07-25 22:17:36
---


## 幂等性

Kafka通过在消息中增加两个 produceid, epochid来记录每条消息的唯一性，可以近似的理解为增加版本号，当某条消息发送失败后， kafka会使用相同的版本号来重试这条消息。 而broker收到每条消息后会判断消息的版本号， 如果当前消息的版本号小于等于已提交的版本号。 则说明这条消息是过期的消息， broker会默默丢弃这条消息， 这就是kafka实现的幂等性。 

但kafka的幂等性有一个作用范围

* Kafka只能保证分区级别的幂等性，即只能保证同一个分区上不出现重复消息
* Kafka只能保证实现单会话的幂等性， 可以理解为同一个生产者的幂等性，不能实现生产者之间的幂等性。 

因此，如果想要是想跨分区、跨会话级别的幂等性，需要使用Kafka提供的另一个特性---事务 

## 事务

Kafka的事务概念